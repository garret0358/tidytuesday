---
title: "#tidytuesday Week 51"
author: "Garret Pittsenbarger"
output: github_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Taking a Look at the Spice Girls

First I load the libraries I plan to use.

```{r message=FALSE, warning=FALSE}
library(tidyverse)
library(skimr)
library(ggplot2)
library(Hmisc)
library(patchwork)
library(ggtext)
```

Then I load the data from tidytuesday.

```{r load data}
studio_album_tracks <- readr::read_csv("https://github.com/jacquietran/spice_girls_data/raw/main/data/studio_album_tracks.csv")
```
### First look

First I take a look at the first few rows of the table...

```{r}
head(studio_album_tracks)
```

...and take a look at the structure...

```{r}
str(studio_album_tracks)
```

...and a peek at the mean values for the various musical qualities for their full body of work.

```{r}
sum_df <- studio_album_tracks %>%
  summarize_if(is.numeric, mean, na.rm = TRUE)
head(sum_df)
```

I'm going to make a smaller table to isolate the data that I'm interested in looking more closely at, the musical quality of each song.

```{r}
music_q <- studio_album_tracks %>% 
  select(album_name, track_number, track_name, duration_ms, key_mode, key_name, mode_name, key, mode, tempo, time_signature, valence, danceability, energy, instrumentalness, acousticness, loudness)
head(music_q)
```

```{r}
skim(music_q)
```

### Initial thoughts

Overall the data looks quite clean, so I will start to dig a little deeper to look for relationships within the data. I think that the positivity of a song (valence) may be affected by the key. I'm curious if the musical quality of the songs are affected by the mode. First I will take a look at the average values for danceability, valence, energy, acousticness, and instrumentalness. I am excluding speechiness, because the mean value is very low for all songs, and liveness, as this is a quality of the performance and not of the music itself.

```{r plot musical quality means}
sum_mode_df <- studio_album_tracks %>% 
  select(mode_name, danceability, valence, energy, acousticness, instrumentalness) %>% 
  group_by(mode_name) %>% 
  summarize_if(is.numeric, mean, na.rm = TRUE)
rdf3 <- sum_mode_df %>% 
  pivot_longer(!mode_name, names_to = "quality") %>% 
  arrange(-value)
ggplot(data = rdf3, aes(x = quality, y = value, color = mode_name)) +
  geom_point(alpha = .8, size = 3) +
  scale_color_manual(values = c("#fab249", "#c84ec8")) +
  coord_flip() +
  annotate(geom = "label", x = 4.5, y = .8, label = "mean valence differs by .223", hjust = "right") +
  labs(title = "Musical Quality", subtitle = "Comparing the musical qualities of <b><span style = 'color:#fab249;'>major</span></b> and <b><span style = 'color:#c84ec8;'>minor</span></b> keys") +
  theme_minimal() +
  theme(legend.position = "none", plot.subtitle = element_markdown())
```

The average valence of the songs in a minor key is much higher than the songs in major keys. Usually we associate major keys with more uplifting music and minor keys with sad or dark music. Let's look more closely at the valence of the songs in both major and minor keys.


```{r plot valence vs. mode}
ggplot(data = music_q, aes(x = mode_name, y = valence)) +
  geom_violin(fill = "#f3e697", color = "#ffdb01", alpha= .5) +
  stat_summary(fun = "mean", geom = "crossbar", width = .3, color = "#f778e4") +
  geom_point(color = "#c84ec8") +
  coord_flip() +
  labs(
    x = "Mode", 
    y = "Level of Valence", 
    title = "Mode/Valence", 
    subtitle = "Spice Girls songs written in minor keys tend to be perceived as positve:", 
    caption = "<b>Data:</b> Spotify, <b>Graphic:</b> Garret P", 
    alt = "This violin plot compares the mode of Spice Girls songs with the valence. The songs written in minor keys tend to be perceived as positive."
    )+
  theme_minimal() +
  theme(plot.caption = element_markdown()) +
  annotate(geom = "text", x = 1.4, y = .03, label = "Songs in a major key have a wide range of valence", hjust = "left")
```

### Digging deeper

I'm surprised that the songs in minor keys rate a higher valence. I want to find out if there are any other strong correlations between these variables. I will check correlations for all relevant numeric columns.

```{r correlation matrix}
cor_music <- music_q %>% 
  select(key, mode, tempo, valence, danceability, energy, instrumentalness, acousticness,loudness) %>% 
  cor() %>% 
  reshape::melt()
head(cor_music)
ggplot(data = cor_music, aes(x = X1, y = X2, fill = value)) +
  geom_tile() +
  scale_fill_gradient2(low = "#ffdb01", high = "#f778e4", mid = "white") +
  labs(x = "Variables", y = "Variables") +
  annotate(
    geom = "curve", x = 3, y = 5, xend = 2, yend = 4, curvature = .2, arrow = arrow(length = unit(2, "mm"))
  ) +
  annotate(
    geom = "curve", x = 5, y = 3, xend = 5, yend = 4, curvature = .2, arrow = arrow(length = unit(2, "mm"))
  ) +
  annotate(geom = "label", x = 3.1, y = 5, label = "valence and mode", hjust = "left") +
  annotate(geom = "label", x = 5, y = 3, label = "valence and danceability", hjust = "center") +
  labs(title = "Correlation", subtitle = "Correlation between various musical qualities:") +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))+
  theme_minimal()
```

This seems to confirm a strong positive between mode and valence. There also seems to be a correlation between dancebility and valence, let's plot to look at it more closely.

```{r valence vs. danceability}
ggplot(data = music_q, aes(x = danceability, y = valence)) +
  geom_smooth(alpha = .4, fill = "#f3e697", color = "#f778e4", method = "gam") +
  geom_point(color = "#c84ec8") +
  labs(title = "Valence/Danceability", subtitle = "A positive correlation exists between valence and danceability:") +
  annotate(geom = "text", x = .3, y = 1, label = "Size of the points indicates tempo", hjust = "left") +
  annotate(geom = "label", x = .3, y = .6, label = "The Lady is a Vamp", hjust = "left") +
  annotate(geom = "label", x = .35, y = .4, label = "Too Much", hjust = "left") +
  annotate(geom = "label", x = .58, y = .1, label = "Time Goes By", hjust = "left") +
  theme(legend.position = "none")+
  theme_minimal()
  
```

When plotting all the songs from across all three albums we can see that most fall within the range of high valence and moderate danceability. There seems to be three songs that don't match fit with this group as well. Each of these songs are also relatively slower than the majority of other songs.

The data shows that in general, as the positivity of a song increases so does the danceability. 
Let's also compare danceability with mode.

```{r danceability vs. mode}
ggplot(data = music_q, aes(x = mode_name, y = danceability)) +
  geom_violin(fill = "#f3e697", color = "#ffdb01", alpha= .5) +
  stat_summary(fun = "mean", geom = "crossbar", width = .3, color = "#f778e4") +
  geom_point(color = "#c84ec8") +
  coord_flip() +
  labs(x = "mode", title = "Mode/Danceability", subtitle = "Relationship between modes and danceability:")+
  theme_minimal()
```

Given the strong positive correlation between danceability and positivity it is no surprise that songs in minor keys also good for dancing when compared with songs in major keys.

### Conclusions

The Spice Girls produced many songs in minor keys that may be perceived as positive and good to dance to. This was contrary to my expectation that songs in a minor key would be categorized as less positive. I would like to dig deeper later to explore the correlation between the themes in the lyrics and how it affects positivity.
